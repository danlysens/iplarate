<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–û—Å—Ç—Ä–æ–≤ —Å–æ–∫—Ä–æ–≤–∏—â –∏ –ª–æ–≤—É—à–∫–∏</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f0e68c;
      padding: 20px;
    }
    h1 { color: #8b4513; }
    #game-info {
      margin: 15px;
      font-size: 18px;
      font-weight: bold;
    }
    #board {
      display: inline-grid;
      grid-template-columns: repeat(10, 40px);
      gap: 2px;
      margin: 20px auto;
    }
    .cell {
      width: 40px;
      height: 40px;
      background: #add8e6;
      border: 1px solid #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
    }
    .start { background: #90ee90; }
    .treasure { background: #ffd700; }
    .player { background: #ffcccb; }
    .trap { background: #ff6347; }
    button {
      padding: 8px 16px;
      font-size: 16px;
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>üèùÔ∏è –û—Å—Ç—Ä–æ–≤ —Å–æ–∫—Ä–æ–≤–∏—â –∏ –ª–æ–≤—É—à–∫–∏</h1>
  <div id="game-info">–í—ã–±–æ—Ä –ª–æ–≤—É—à–µ–∫: –ò–≥—Ä–æ–∫ 1</div>
  <div id="board"></div>
  <div>
    <button id="next-action">–î–∞–ª–µ–µ</button>
    <button id="reset">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  </div>

  <script>
    const size = 10;
    let currentPlayer = 1;
    let phase = 'placeTraps'; // placeTraps –∏–ª–∏ playGame
    let traps = new Set(); // –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ª–æ–≤—É—à–µ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'row,col'
    let playerPos = { 1: [9, 0], 2: [9, 0] }; // [row, col], —Å—Ç–∞—Ä—Ç –≤ –ª–µ–≤–æ–º –Ω–∏–∂–Ω–µ–º
    let trapsPlaced = { 1: 0, 2: 0 };
    let maxTraps = 3;

    const board = document.getElementById('board');
    const info = document.getElementById('game-info');
    const nextBtn = document.getElementById('next-action');
    const resetBtn = document.getElementById('reset');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—è
    function initBoard() {
      board.innerHTML = '';
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.row = r;
          cell.dataset.col = c;
          if (r === 9 && c === 0) cell.classList.add('start');
          if (r === 0 && c === 9) cell.classList.add('treasure');
          cell.textContent = '';
          board.appendChild(cell);
        }
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function render() {
      // –û—á–∏—Å—Ç–∫–∞ –º–µ—Ç–æ–∫
      document.querySelectorAll('.cell').forEach(cell => {
        cell.classList.remove('player');
        if (!cell.classList.contains('start') && !cell.classList.contains('treasure')) {
          cell.classList.remove('trap');
        }
      });

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
      const [r, c] = playerPos[currentPlayer];
      const playerCell = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
      if (playerCell) playerCell.classList.add('player');

      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–∑–µ
      if (phase === 'placeTraps') {
        info.textContent = `–í—ã–±–æ—Ä –ª–æ–≤—É—à–µ–∫: –ò–≥—Ä–æ–∫ ${currentPlayer}`;
      } else {
        info.textContent = `–•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${currentPlayer}`;
      }
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–≤—É—à–∫–∏
    function placeTrap(row, col) {
      if (phase !== 'placeTraps') return;
      if ((row === 9 && col === 0) || (row === 0 && col === 9)) return; // –Ω–µ–ª—å–∑—è –≤ —Å—Ç–∞—Ä—Ç/—Å–æ–∫—Ä–æ–≤–∏—â–µ
      const key = `${row},${col}`;
      if (traps.has(key)) return; // —É–∂–µ –µ—Å—Ç—å –ª–æ–≤—É—à–∫–∞

      traps.add(key);
      trapsPlaced[currentPlayer]++;

      if (trapsPlaced[currentPlayer] >= maxTraps) {
        currentPlayer = currentPlayer === 1 ? 2 : 1;
        if (trapsPlaced[currentPlayer] >= maxTraps) {
          // –í—Å–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–æ–≤—É—à–∫–∏ ‚Äî –Ω–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É
          currentPlayer = 1;
          phase = 'playGame';
        }
      }
      render();
    }

    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
    function movePlayer(dr, dc) {
      if (phase !== 'playGame') return;
      const [r, c] = playerPos[currentPlayer];
      let nr = r + dr;
      let nc = c + dc;

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
      if (nr < 0 || nr >= size || nc < 0 || nc >= size) return;

      playerPos[currentPlayer] = [nr, nc];

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≤—É—à–∫–∏
      const key = `${nr},${nc}`;
      if (traps.has(key)) {
        // –°—Ä–∞–±–æ—Ç–∞–ª–∞ –ª–æ–≤—É—à–∫–∞!
        playerPos[currentPlayer] = [9, 0]; // –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç–∞—Ä—Ç
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≤—É—à–∫—É –∫—Ä–∞—Å–Ω—ã–º (–ø–∞–ª–µ–≤–æ!)
        const trapCell = document.querySelector(`.cell[data-row="${nr}"][data-col="${nc}"]`);
        trapCell.classList.add('trap');
        setTimeout(() => alert(`–ò–≥—Ä–æ–∫ ${currentPlayer} –ø–æ–ø–∞–ª –≤ –ª–æ–≤—É—à–∫—É! –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç–∞—Ä—Ç.`), 50);
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
      if (nr === 0 && nc === 9) {
        alert(`–ò–≥—Ä–æ–∫ ${currentPlayer} –Ω–∞—à—ë–ª —Å–æ–∫—Ä–æ–≤–∏—â–µ! –ü–æ–±–µ–¥–∞! üéâ`);
        phase = 'ended';
        return;
      }

      // –ü–µ—Ä–µ–¥–∞—á–∞ —Ö–æ–¥–∞
      currentPlayer = currentPlayer === 1 ? 2 : 1;
      render();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    board.addEventListener('click', (e) => {
      if (!e.target.classList.contains('cell')) return;
      const r = parseInt(e.target.dataset.row);
      const c = parseInt(e.target.dataset.col);

      if (phase === 'placeTraps') {
        placeTrap(r, c);
      }
    });

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–¥–∞–º–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É (–∏–ª–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–µ–ª–∫–∏ –ø–æ–∑–∂–µ)
    nextBtn.addEventListener('click', () => {
      if (phase === 'playGame') {
        // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Å–æ–æ–±—â–∏–º, —á—Ç–æ —Ö–æ–¥ –¥–µ–ª–∞–µ—Ç—Å—è –∫–ª–∏–∫–æ–º –ø–æ –∫–ª–µ—Ç–∫–µ (–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑ –∏ —Ç.–¥.)
        // –ù–æ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è ‚Äî –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–µ–¥–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        alert('–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–ª–µ—Ç–∫—É —Ä—è–¥–æ–º —Å –≤–∞—à–µ–π —Ñ–∏—à–∫–æ–π, —á—Ç–æ–±—ã —Ç—É–¥–∞ —Å—Ö–æ–¥–∏—Ç—å.');
      } else if (phase === 'placeTraps' && trapsPlaced[1] >= maxTraps && trapsPlaced[2] >= maxTraps) {
        phase = 'playGame';
        currentPlayer = 1;
        render();
      }
    });

    resetBtn.addEventListener('click', () => {
      location.reload();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    initBoard();
    render();
  </script>
</body>
</html>
